{% extends 'wybory/base.html' %}
{% load static %}

{% block title %}Powiadomienia{% endblock %}

{% block content %}

<link rel="stylesheet" href="{% static 'css/notifications.css' %}">

<h2>Twoje Powiadomienia</h2>

<ul class="notification-list">
    {% for notification in notifications %}
        <li class="notification-item {% if not notification.is_read %}unread{% endif %}">
            <strong class="notification-title">{{ notification.title }}</strong><br>
            <p class="notification-message">{{ notification.message }}</p>
            <small class="notification-date">Dodano: {{ notification.created_at|date:"d M Y H:i" }}</small><br>

            {% if not notification.is_read %}
                <span class="notification-status unread-label">(Nieprzeczytane)</span>
                <button class="mark-as-read" data-id="{{ notification.id }}">Oznacz jako przeczytane</button>
            {% else %}
                <span class="notification-status read-label">(Przeczytane)</span>
            {% endif %}
        </li>
    {% endfor %}
</ul>

{% csrf_token %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const buttons = document.querySelectorAll('.mark-as-read');
    buttons.forEach(button => {
        button.addEventListener('click', function () {
            const notificationId = this.getAttribute('data-id');
            fetch("{% url 'notifications' %}", {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `notification_id=${notificationId}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    location.reload();
                }
            });
        });
    });
});
</script>

{% endblock %}
